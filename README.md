<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

# Fastseq

> A way to use fastai with sequence data


## Installing

Please install [fastai2](https://dev.fast.ai/#Installing) according to the instructions.

Then install Fastseq by:
```
pip install -e .
```

## How to use
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
from fastseq.all import *
from fastai2.basics import *
from fastseq.models.nbeats import *
from fastseq.data.external import *
```

</div>

</div>

Getting the data fastai style:
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
path = untar_data(URLs.m4_daily)
data = TSDataBunch.from_folder(path, horizon = 14,nrows = 30,step=3)
```

</div>
<div class="output_area" markdown="1">

    Train:7562; Valid: 90; Test 30


</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
# items = dummy_data_generator(50, 10, nrows=1000)
# data = TSDataBunch.from_items(items, horizon = 7)
data.show_batch()
```

</div>
<div class="output_area" markdown="1">


![png](docs/images/output_5_0.png)


</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
# TODO make custom learner with custom model
learn = nbeats_learner(data, b_loss=.2,
                       loss_func= CombinedLoss(F.mse_loss, smape, ratio = {'smape':.1}))
```

</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
from fastai2.callback.all import *
learn.lr_find()
```

</div>
<div class="output_area" markdown="1">






![png](docs/images/output_7_1.png)


</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
learn.fit_one_cycle(1, 2e-3)
learn.recorder.plot_loss()
```

</div>
<div class="output_area" markdown="1">


<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>mae</th>
      <th>smape</th>
      <th>mse_loss</th>
      <th>theta</th>
      <th>b_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>253.582031</td>
      <td>252.472183</td>
      <td>6.555329</td>
      <td>1907.065674</td>
      <td>50.684994</td>
      <td>0.982327</td>
      <td>55.402950</td>
      <td>00:08</td>
    </tr>
  </tbody>
</table>



![png](docs/images/output_8_1.png)


</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
learn.show_results(2,max_n=9)
```

</div>
<div class="output_area" markdown="1">






![png](docs/images/output_9_1.png)


</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
from fastai2.interpret import *
from fastseq.interpret import *
```

</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
interp = NBeatsInterpretation.from_learner(learn)
```

</div>
<div class="output_area" markdown="1">





</div>

</div>
<div class="codecell" markdown="1">
<div class="input_area" markdown="1">

```
interp.plot_top_losses(9)
```

</div>
<div class="output_area" markdown="1">


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-50-776eb7830b8b> in <module>
    ----> 1 interp.plot_top_losses(9)
    

    ~/dev/fastseq/fastseq/interpret.py in plot_top_losses(self, k, largest, **kwargs)
         30         losses,idx = self.top_losses(k, largest)
         31         total_b = self.dct.pop('total_b')[idx, :]
    ---> 32         backwards = {block+'_b':self.dct[block]['b'][idx,:] for block in self.dct}
         33         forwards = {block+'_f':self.dct[block]['f'][idx,:] for block in self.dct}
         34 


    ~/dev/fastseq/fastseq/interpret.py in <dictcomp>(.0)
         30         losses,idx = self.top_losses(k, largest)
         31         total_b = self.dct.pop('total_b')[idx, :]
    ---> 32         backwards = {block+'_b':self.dct[block]['b'][idx,:] for block in self.dct}
         33         forwards = {block+'_f':self.dct[block]['f'][idx,:] for block in self.dct}
         34 


    NameError: name 'l_dct' is not defined


</div>

</div>
