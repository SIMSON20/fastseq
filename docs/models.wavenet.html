---

title: Wavenet model

keywords: fastai
sidebar: home_sidebar

summary: "The WaveNet` architecture for time series forecasting. <https://arxiv.org/pdf/1609.03499.pdf>"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_models.wavenet.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ConcreteDropout" class="doc_header"><code>class</code> <code>ConcreteDropout</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/models/wavenet.py#L13" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ConcreteDropout</code>(<strong><code>dropout_regularizer</code></strong>=<em><code>1e-05</code></em>, <strong><code>init_range</code></strong>=<em><code>(0.1, 0.3)</code></em>, <strong><code>channel_wise</code></strong>=<em><code>False</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Applies Dropout to the input, even at prediction time and learns dropout probability
from the data.</p>
<p>In convolutional neural networks, we can use dropout to drop entire channels using
the 'channel_wise' argument.</p>
<p>Arguments:</p>

<pre><code>* dropout_regularizer (float): Should  be set to 2 / N, where N is the number of training examples.
* init_range (tuple): Initial range for dropout probabilities.
* channel_wise (boolean): apply dropout over all input or across convolutional channels.</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WaveNet" class="doc_header"><code>class</code> <code>WaveNet</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/models/wavenet.py#L93" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WaveNet</code>(<strong><code>input_channels</code></strong>, <strong><code>output_channels</code></strong>, <strong><code>horizon</code></strong>, <strong><code>hidden_channels</code></strong>=<em><code>64</code></em>, <strong><code>skip_channels</code></strong>=<em><code>64</code></em>, <strong><code>n_layers</code></strong>=<em><code>7</code></em>, <strong><code>n_blocks</code></strong>=<em><code>1</code></em>, <strong><code>dilation</code></strong>=<em><code>2</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Implements <a href="models.wavenet.html#WaveNet"><code>WaveNet</code></a> architecture for time series forecasting. Inherits
from pytorch <code>Module &lt;https://pytorch.org/docs/stable/nn.html#torch.nn.Module&gt;</code>_.
Vector forecasts are made via a fully-connected linear layer.
References:</p>

<pre><code>- `WaveNet: A Generative Model for Raw Audio &lt;https://arxiv.org/pdf/1609.03499.pdf&gt;`_

</code></pre>
<p>Arguments:</p>

<pre><code>* input_channels (int): Number of covariates in input time series.
* output_channels (int): Number of target time series.
* horizon (int): Number of time steps to forecast.
* hidden_channels (int): Number of channels in convolutional hidden layers.
* skip_channels (int): Number of channels in convolutional layers for skip connections.
* n_layers (int): Number of layers per Wavenet block (determines receptive field size).
* n_blocks (int): Number of Wavenet blocks.
* dilation (int): Dilation factor for temporal convolution.</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Test">Test<a class="anchor-link" href="#Test">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastseq.data.load</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastseq.data.transforms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai2.data.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">horizon</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">lookback</span> <span class="o">=</span> <span class="mi">128</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">lenghts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">data_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">+.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="n">l</span><span class="p">]),</span>
              <span class="n">t</span><span class="p">[:</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()),</span>
             <span class="p">])</span>
              <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lenghts</span><span class="p">)]</span>

<span class="c1"># print([d.shape for d in data_train])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ts_ds</span> <span class="o">=</span> <span class="n">TimeSeriesDataset</span><span class="p">(</span>
    <span class="n">data_train</span><span class="p">,</span>
    <span class="n">lookback</span><span class="p">,</span>
    <span class="n">horizon</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">static_covs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">ToTensor</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">ts_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">ts_ds</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Dropped 33/10000 time series due to length.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">WaveNet</span><span class="p">(</span><span class="n">input_channels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">output_channels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">,</span>
                    
               <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of model parameters: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">n_parameters</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Receptive field size: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">receptive_field_size</span><span class="p">))</span>

<span class="c1"># # .. and the loss</span>
<span class="c1"># loss = torch.distributions.StudentT</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of model parameters: 125076.
Receptive field size: 128.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">DataBunch</span><span class="p">(</span><span class="n">ts_dl</span><span class="p">,</span> <span class="n">ts_dl</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">Adam</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai2.callback.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(#3) [0,nan,01:10]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-14-4167bfcb4cc5&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">from</span> fastai2<span class="ansi-blue-fg">.</span>callback<span class="ansi-blue-fg">.</span>all <span class="ansi-green-fg">import</span> <span class="ansi-blue-fg">*</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>learn<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/learner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, n_epoch, lr, wd, cbs, reset_opt)</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span>                     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    287</span>                         self<span class="ansi-blue-fg">.</span>epoch<span class="ansi-blue-fg">=</span>epoch<span class="ansi-blue-fg">;</span>          self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;begin_epoch&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 288</span><span class="ansi-red-fg">                         </span>self<span class="ansi-blue-fg">.</span>_do_epoch_train<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    289</span>                         self<span class="ansi-blue-fg">.</span>_do_epoch_validate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span>                     <span class="ansi-green-fg">except</span> CancelEpochException<span class="ansi-blue-fg">:</span>   self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;after_cancel_epoch&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/learner.py</span> in <span class="ansi-cyan-fg">_do_epoch_train</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>             self<span class="ansi-blue-fg">.</span>dl <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>dbunch<span class="ansi-blue-fg">.</span>train_dl<span class="ansi-blue-fg">;</span>                  self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;begin_train&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 263</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>all_batches<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>         <span class="ansi-green-fg">except</span> CancelTrainException<span class="ansi-blue-fg">:</span>                         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;after_cancel_train&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>                                             self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;after_train&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/learner.py</span> in <span class="ansi-cyan-fg">all_batches</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    239</span>     <span class="ansi-green-fg">def</span> all_batches<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    240</span>         self<span class="ansi-blue-fg">.</span>n_iter <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dl<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 241</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> o <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dl<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>o<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    242</span> 
<span class="ansi-green-intense-fg ansi-bold">    243</span>     <span class="ansi-green-fg">def</span> one_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> i<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/learner.py</span> in <span class="ansi-cyan-fg">one_batch</span><span class="ansi-blue-fg">(self, i, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    245</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    246</span>             self<span class="ansi-blue-fg">.</span>_split<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">;</span>                                  self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;begin_batch&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 247</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>pred <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>xb<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">;</span>                self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;after_pred&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    248</span>             <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>yb<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span>
<span class="ansi-green-intense-fg ansi-bold">    249</span>             self<span class="ansi-blue-fg">.</span>loss <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>loss_func<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>pred<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>yb<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">;</span> self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;after_loss&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.6/site-packages/torch/nn/modules/module.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *input, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    539</span>             result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_slow_forward<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>input<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    540</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 541</span><span class="ansi-red-fg">             </span>result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>forward<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>input<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    542</span>         <span class="ansi-green-fg">for</span> hook <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_forward_hooks<span class="ansi-blue-fg">.</span>values<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    543</span>             hook_result <span class="ansi-blue-fg">=</span> hook<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> input<span class="ansi-blue-fg">,</span> result<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-5-d6265dc38e1d&gt;</span> in <span class="ansi-cyan-fg">forward</span><span class="ansi-blue-fg">(self, inputs)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>     <span class="ansi-green-fg">def</span> forward<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> inputs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         <span class="ansi-blue-fg">&#34;&#34;&#34;Forward function.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; 85</span><span class="ansi-red-fg">         </span>output<span class="ansi-blue-fg">,</span> reg_e <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span>inputs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>         output_mean<span class="ansi-blue-fg">,</span> output_std<span class="ansi-blue-fg">,</span> output_df<span class="ansi-blue-fg">,</span> reg_d <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>output<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span> 

<span class="ansi-green-fg">&lt;ipython-input-5-d6265dc38e1d&gt;</span> in <span class="ansi-cyan-fg">encode</span><span class="ansi-blue-fg">(self, inputs)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>         <span class="ansi-green-fg">for</span> do<span class="ansi-blue-fg">,</span> conv<span class="ansi-blue-fg">,</span> skip<span class="ansi-blue-fg">,</span> resi <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>do<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>conv<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>skip<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>resi<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    106</span>             layer_in <span class="ansi-blue-fg">=</span> output
<span class="ansi-green-fg">--&gt; 107</span><span class="ansi-red-fg">             </span>output<span class="ansi-blue-fg">,</span> reg <span class="ansi-blue-fg">=</span> do<span class="ansi-blue-fg">(</span>layer_in<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>             output <span class="ansi-blue-fg">=</span> conv<span class="ansi-blue-fg">(</span>output<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span>             output <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>nn<span class="ansi-blue-fg">.</span>functional<span class="ansi-blue-fg">.</span>relu<span class="ansi-blue-fg">(</span>output<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.6/site-packages/torch/nn/modules/module.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *input, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    539</span>             result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_slow_forward<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>input<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    540</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 541</span><span class="ansi-red-fg">             </span>result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>forward<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>input<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    542</span>         <span class="ansi-green-fg">for</span> hook <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_forward_hooks<span class="ansi-blue-fg">.</span>values<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    543</span>             hook_result <span class="ansi-blue-fg">=</span> hook<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> input<span class="ansi-blue-fg">,</span> result<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-4-e9d54d461a52&gt;</span> in <span class="ansi-cyan-fg">forward</span><span class="ansi-blue-fg">(self, x)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span> 
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-red-fg"># Apply Concrete Dropout to input</span>
<span class="ansi-green-fg">---&gt; 36</span><span class="ansi-red-fg">         </span>out <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_concrete_dropout<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> p<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span> 
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-red-fg"># Regularization term for dropout parameters</span>

<span class="ansi-green-fg">&lt;ipython-input-4-e9d54d461a52&gt;</span> in <span class="ansi-cyan-fg">_concrete_dropout</span><span class="ansi-blue-fg">(self, x, p)</span>
<span class="ansi-green-intense-fg ansi-bold">     65</span>                      <span class="ansi-blue-fg">-</span> torch<span class="ansi-blue-fg">.</span>log<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span> p <span class="ansi-blue-fg">+</span> eps<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     66</span>                      <span class="ansi-blue-fg">+</span> torch<span class="ansi-blue-fg">.</span>log<span class="ansi-blue-fg">(</span>unif_noise <span class="ansi-blue-fg">+</span> eps<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 67</span><span class="ansi-red-fg">                      - torch.log(1 - unif_noise + eps))
</span><span class="ansi-green-intense-fg ansi-bold">     68</span>         drop_prob <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>sigmoid<span class="ansi-blue-fg">(</span>drop_prob <span class="ansi-blue-fg">/</span> temp<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     69</span>         random_tensor <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span> drop_prob

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

