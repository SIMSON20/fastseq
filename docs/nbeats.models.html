---

title: N-Beats model

keywords: fastai
sidebar: home_sidebar

summary: "A basic architecture for time series forecasting."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_nbeats.models.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Blocks">Blocks<a class="anchor-link" href="#Blocks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="linspace" class="doc_header"><code>linspace</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L18" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>linspace</code>(<strong><code>lookback</code></strong>, <strong><code>horizon</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Block" class="doc_header"><code>class</code> <code>Block</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Block</code>(<strong><code>fnc_f</code></strong>, <strong><code>fnc_b</code></strong>=<em><code>None</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bias_model" class="doc_header"><code>bias_model</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bias_model</code>(<strong><code>thetas</code></strong>, <strong><code>t</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BiasBlock" class="doc_header"><code>class</code> <code>BiasBlock</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L73" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BiasBlock</code>(<strong><code>layers</code></strong>:<code>L</code>, <strong><code>device</code></strong>, <strong><code>thetas_dim</code></strong>=<em><code>2</code></em>, <strong><code>lookback</code></strong>=<em><code>10</code></em>, <strong><code>horizon</code></strong>=<em><code>5</code></em>, <strong><code>use_bn</code></strong>=<em><code>True</code></em>, <strong><code>bn_final</code></strong>=<em><code>False</code></em>, <strong><code>ps</code></strong>:<code>L</code>=<em><code>None</code></em>) :: <a href="/fastseq/nbeats.metrics#Block"><code>Block</code></a></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">BiasBlock</span><span class="p">([</span><span class="mi">256</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span> <span class="n">lookback</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="n">mdl</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,(</span><span class="mi">64</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LinearD" class="doc_header"><code>class</code> <code>LinearD</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L85" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LinearD</code>(<strong><code>in_features</code></strong>, <strong><code>out_features</code></strong>, <strong><code>bias</code></strong>=<em><code>True</code></em>) :: <code>Linear</code></p>
</blockquote>
<p>Applies a linear transformation to the incoming data: :math:<code>y = xA^T + b</code></p>
<p>Args:
    in_features: size of each input sample
    out_features: size of each output sample
    bias: If set to <code>False</code>, the layer will not learn an additive bias.
        Default: <code>True</code></p>
<p>Shape:</p>

<pre><code>- Input: :math:`(N, *, H_{in})` where :math:`*` means any number of
  additional dimensions and :math:`H_{in} = \text{in\_features}`
- Output: :math:`(N, *, H_{out})` where all but the last dimension
  are the same shape as the input and :math:`H_{out} = \text{out\_features}`.

</code></pre>
<p>Attributes:
    weight: the learnable weights of the module of shape
        :math:<code>(\text{out\_features}, \text{in\_features})</code>. The values are
        initialized from :math:<code>\mathcal{U}(-\sqrt{k}, \sqrt{k})</code>, where
        :math:<code>k = \frac{1}{\text{in\_features}}</code>
    bias:   the learnable bias of the module of shape :math:<code>(\text{out\_features})</code>.
            If :attr:<code>bias</code> is <code>True</code>, the values are initialized from
            :math:<code>\mathcal{U}(-\sqrt{k}, \sqrt{k})</code> where
            :math:<code>k = \frac{1}{\text{in\_features}}</code></p>
<p>Examples::</p>

<pre><code>&gt;&gt;&gt; m = nn.Linear(20, 30)
&gt;&gt;&gt; input = torch.randn(128, 20)
&gt;&gt;&gt; output = m(input)
&gt;&gt;&gt; print(output.size())
torch.Size([128, 30])</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GenericBlock" class="doc_header"><code>class</code> <code>GenericBlock</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L89" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GenericBlock</code>(<strong><code>layers</code></strong>:<code>L</code>, <strong><code>thetas_dim</code></strong>:<code>int</code>, <strong><code>device</code></strong>, <strong><code>lookback</code></strong>=<em><code>10</code></em>, <strong><code>horizon</code></strong>=<em><code>5</code></em>, <strong><code>use_bn</code></strong>=<em><code>True</code></em>, <strong><code>bn_final</code></strong>=<em><code>False</code></em>, <strong><code>ps</code></strong>:<code>L</code>=<em><code>None</code></em>, <strong><code>share_thetas</code></strong>=<em><code>True</code></em>, <strong><code>y_range</code></strong>=<em><code>[-0.5, 0.5]</code></em>) :: <a href="/fastseq/nbeats.metrics#Block"><code>Block</code></a></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">GenericBlock</span><span class="p">([</span><span class="mi">256</span><span class="p">],</span> <span class="n">thetas_dim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span> <span class="n">lookback</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="n">mdl</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="seasonality_model" class="doc_header"><code>seasonality_model</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L100" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>seasonality_model</code>(<strong><code>thetas</code></strong>, <strong><code>t</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SeasonalityBlock" class="doc_header"><code>class</code> <code>SeasonalityBlock</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L109" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SeasonalityBlock</code>(<strong><code>layers</code></strong>:<code>L</code>, <strong><code>thetas_dim</code></strong>:<code>int</code>, <strong><code>device</code></strong>, <strong><code>lookback</code></strong>=<em><code>10</code></em>, <strong><code>horizon</code></strong>=<em><code>5</code></em>, <strong><code>use_bn</code></strong>=<em><code>True</code></em>, <strong><code>bn_final</code></strong>=<em><code>False</code></em>, <strong><code>ps</code></strong>:<code>L</code>=<em><code>None</code></em>, <strong><code>share_thetas</code></strong>=<em><code>True</code></em>, <strong><code>y_range</code></strong>=<em><code>[-0.5, 0.5]</code></em>) :: <a href="/fastseq/nbeats.metrics#Block"><code>Block</code></a></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">SeasonalityBlock</span><span class="p">([</span><span class="mi">256</span><span class="p">],</span> <span class="n">thetas_dim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span> <span class="n">lookback</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="n">mdl</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="trend_model" class="doc_header"><code>trend_model</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>trend_model</code>(<strong><code>thetas</code></strong>, <strong><code>t</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TrendBlock" class="doc_header"><code>class</code> <code>TrendBlock</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L125" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TrendBlock</code>(<strong><code>layers</code></strong>:<code>L</code>, <strong><code>device</code></strong>, <strong><code>thetas_dim</code></strong>, <strong><code>lookback</code></strong>=<em><code>10</code></em>, <strong><code>horizon</code></strong>=<em><code>5</code></em>, <strong><code>use_bn</code></strong>=<em><code>True</code></em>, <strong><code>bn_final</code></strong>=<em><code>False</code></em>, <strong><code>ps</code></strong>:<code>L</code>=<em><code>None</code></em>, <strong><code>share_thetas</code></strong>=<em><code>True</code></em>, <strong><code>y_range</code></strong>=<em><code>[-0.05, 0.05]</code></em>) :: <a href="/fastseq/nbeats.metrics#Block"><code>Block</code></a></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">TrendBlock</span><span class="p">([</span><span class="mi">256</span><span class="p">],</span> <span class="n">thetas_dim</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">),</span> <span class="n">lookback</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">dct</span> <span class="o">=</span> <span class="n">mdl</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,(</span><span class="mi">64</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="select_block" class="doc_header"><code>select_block</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L136" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>select_block</code>(<strong><code>o</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NBeatsNet" class="doc_header"><code>class</code> <code>NBeatsNet</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L157" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NBeatsNet</code>(<strong><code>device</code></strong>, <strong><code>stack_types</code></strong>=<em><code>('bias', 'trend', 'seaonality')</code></em>, <strong><code>nb_blocks_per_stack</code></strong>=<em><code>3</code></em>, <strong><code>horizon</code></strong>=<em><code>5</code></em>, <strong><code>lookback</code></strong>=<em><code>10</code></em>, <strong><code>thetas_dim</code></strong>=<em><code>None</code></em>, <strong><code>share_weights_in_stack</code></strong>=<em><code>False</code></em>, <strong><code>layers</code></strong>=<em><code>[200, 100]</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">NBeatsNet</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">),</span> <span class="n">stack_types</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;seaonality&#39;</span><span class="p">),</span> <span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dct</span> <span class="o">=</span> <span class="n">mdl</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([(</span><span class="n">stack</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">stack</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>torch.Size([64, 1, 5]) torch.Size([64, 1, 10])
[(&#39;seaonality0_0&#39;, tensor([ 0.0207,  0.0037, -0.0042], grad_fn=&lt;MeanBackward1&gt;)), (&#39;seaonality0_1&#39;, tensor([ 0.0127, -0.0004,  0.0007], grad_fn=&lt;MeanBackward1&gt;)), (&#39;seaonality0_2&#39;, tensor([-0.0190, -0.0260,  0.0091], grad_fn=&lt;MeanBackward1&gt;))]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Callback">Callback<a class="anchor-link" href="#Callback">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NBeatsTrainer" class="doc_header"><code>class</code> <code>NBeatsTrainer</code><a href="https://github.com/takotab/fastseq/tree/master/fastseq/nbeats/model.py#L224" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NBeatsTrainer</code>() :: <code>Callback</code></p>
</blockquote>
<p><code>Callback</code> that stores extra outputs of N-Beats training and make the output only the forecast.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">with_decoded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">its</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">its</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(fastseq.core.TSTensorSeq,
 fastseq.core.TSTensorSeqy,
 fastcore.foundation.L,
 fastcore.utils.Tuple,
 torch.Tensor)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-21-e64c18c49458&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>learn<span class="ansi-blue-fg">.</span>dls<span class="ansi-blue-fg">.</span>show_results<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> preds<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">show_results</span><span class="ansi-blue-fg">(self, b, out, max_n, ctxs, show, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span>         x<span class="ansi-blue-fg">,</span>y<span class="ansi-blue-fg">,</span>its <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span>         b_out <span class="ansi-blue-fg">=</span> b<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>self<span class="ansi-blue-fg">.</span>n_inp<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">(</span>tuple<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> is_listy<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 96</span><span class="ansi-red-fg">         </span>x1<span class="ansi-blue-fg">,</span>y1<span class="ansi-blue-fg">,</span>outs <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>show_batch<span class="ansi-blue-fg">(</span>b_out<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span>x1<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> its <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> <span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> its<span class="ansi-blue-fg">,</span> outs<span class="ansi-blue-fg">.</span>itemgot<span class="ansi-blue-fg">(</span>slice<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>n_inp<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     98</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> show<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> res

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">show_batch</span><span class="ansi-blue-fg">(self, b, max_n, ctxs, show, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>     <span class="ansi-green-fg">def</span> show_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">,</span> ctxs<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>         <span class="ansi-green-fg">if</span> b <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> b <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 90</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> show<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_pre_show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     91</span>         show_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>_pre_show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> ctxs<span class="ansi-blue-fg">=</span>ctxs<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     92</span> 

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">_pre_show_batch</span><span class="ansi-blue-fg">(self, b, max_n)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>     <span class="ansi-green-fg">def</span> _pre_show_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     81</span>         <span class="ansi-blue-fg">&#34;Decode `b` to be ready for `show_batch`&#34;</span>
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg">         </span>b <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;show&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> b<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         its <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_decode_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span>Pipeline<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> f<span class="ansi-blue-fg">.</span>split_idx<span class="ansi-blue-fg">=</span>split_idx
<span class="ansi-green-intense-fg ansi-bold">     71</span> 
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> decode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>before_batch<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>to_cpu<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>after_batch<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_retain_dl<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>     <span class="ansi-green-fg">def</span> decode_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_decode_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, o, full)</span>
<span class="ansi-green-intense-fg ansi-bold">    194</span> 
<span class="ansi-green-intense-fg ansi-bold">    195</span>     <span class="ansi-green-fg">def</span> decode  <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 196</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> full<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> compose_tfms<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">,</span> tfms<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">,</span> is_enc<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> reverse<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>split_idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span>         <span class="ansi-red-fg">#Not full means we decode up to the point the item knows how to show itself.</span>
<span class="ansi-green-intense-fg ansi-bold">    198</span>         <span class="ansi-green-fg">for</span> f <span class="ansi-green-fg">in</span> reversed<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">compose_tfms</span><span class="ansi-blue-fg">(x, tfms, is_enc, reverse, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>     <span class="ansi-green-fg">for</span> f <span class="ansi-green-fg">in</span> tfms<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    135</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> is_enc<span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">.</span>decode
<span class="ansi-green-fg">--&gt; 136</span><span class="ansi-red-fg">         </span>x <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>     <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">    138</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>     <span class="ansi-green-fg">def</span> name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_name&#39;</span><span class="ansi-blue-fg">,</span> _get_name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;encodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> decode  <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;decodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>     <span class="ansi-green-fg">def</span> __repr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#39;{self.name}: {self.use_as_item} {self.encodes} {self.decodes}&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_call</span><span class="ansi-blue-fg">(self, fn, x, split_idx, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>         <span class="ansi-green-fg">if</span> split_idx<span class="ansi-blue-fg">!=</span>self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">and</span> self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">     81</span>         f <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>use_as_item <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> is_listy<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         res <span class="ansi-blue-fg">=</span> tuple<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> x_<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> x_ <span class="ansi-green-fg">in</span> x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         <span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_do_call</span><span class="ansi-blue-fg">(self, f, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     85</span> 
<span class="ansi-green-intense-fg ansi-bold">     86</span>     <span class="ansi-green-fg">def</span> _do_call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 87</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> x <span class="ansi-green-fg">if</span> f <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> retain_type<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">.</span>returns_none<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span> 
<span class="ansi-green-intense-fg ansi-bold">     89</span> add_docs<span class="ansi-blue-fg">(</span>Transform<span class="ansi-blue-fg">,</span> decode<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Delegate to `decodes` to undo transform&#34;</span><span class="ansi-blue-fg">,</span> setup<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Delegate to `setups` to set up transform&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/dispatch.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> f<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>inst <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> MethodType<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>inst<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 98</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span> 
<span class="ansi-green-intense-fg ansi-bold">    100</span>     <span class="ansi-green-fg">def</span> __get__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> inst<span class="ansi-blue-fg">,</span> owner<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastseq/fastseq/data/transforms.py</span> in <span class="ansi-cyan-fg">decodes</span><span class="ansi-blue-fg">(self, o)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> 
<span class="ansi-green-intense-fg ansi-bold">     19</span>     <span class="ansi-green-fg">def</span> decodes<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> Tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>s<span class="ansi-blue-fg">+</span>self<span class="ansi-blue-fg">.</span>m <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastseq/fastseq/data/transforms.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> 
<span class="ansi-green-intense-fg ansi-bold">     19</span>     <span class="ansi-green-fg">def</span> decodes<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> Tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>s<span class="ansi-blue-fg">+</span>self<span class="ansi-blue-fg">.</span>m <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/torch_core.py</span> in <span class="ansi-cyan-fg">_f</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>         <span class="ansi-green-fg">def</span> _f<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>             cls <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>__class__
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">             </span>res <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>super<span class="ansi-blue-fg">(</span>TensorBase<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>             <span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span>         <span class="ansi-green-fg">return</span> _f

<span class="ansi-red-fg">RuntimeError</span>: expected device cpu but got device cuda:0</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># x,y,its = data.show_batch([0,2,3], max_n=10, show=False)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">()</span>
<span class="c1"># x,y,its</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Need to pad 3/3 time series due to length.
Need to pad 3/3 time series due to length.
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-22-d2fc95f28f5e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># x,y,its = data.show_batch([0,2,3], max_n=10, show=False)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>learn<span class="ansi-blue-fg">.</span>show_results<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-red-fg"># x,y,its</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/learner.py</span> in <span class="ansi-cyan-fg">show_results</span><span class="ansi-blue-fg">(self, ds_idx, dl, max_n, shuffle, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    333</span>         b <span class="ansi-blue-fg">=</span> dl<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    334</span>         _<span class="ansi-blue-fg">,</span>_<span class="ansi-blue-fg">,</span>preds <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>get_preds<span class="ansi-blue-fg">(</span>dl<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span>b<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> with_decoded<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 335</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>dls<span class="ansi-blue-fg">.</span>show_results<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> preds<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    336</span> 
<span class="ansi-green-intense-fg ansi-bold">    337</span>     <span class="ansi-green-fg">def</span> show_training_loop<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">show_results</span><span class="ansi-blue-fg">(self, b, out, max_n, ctxs, show, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span>         x<span class="ansi-blue-fg">,</span>y<span class="ansi-blue-fg">,</span>its <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span>         b_out <span class="ansi-blue-fg">=</span> b<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>self<span class="ansi-blue-fg">.</span>n_inp<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">(</span>tuple<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> is_listy<span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-blue-fg">(</span>out<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 96</span><span class="ansi-red-fg">         </span>x1<span class="ansi-blue-fg">,</span>y1<span class="ansi-blue-fg">,</span>outs <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>show_batch<span class="ansi-blue-fg">(</span>b_out<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span>x1<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> its <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> <span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> its<span class="ansi-blue-fg">,</span> outs<span class="ansi-blue-fg">.</span>itemgot<span class="ansi-blue-fg">(</span>slice<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>n_inp<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     98</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> show<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> res

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">show_batch</span><span class="ansi-blue-fg">(self, b, max_n, ctxs, show, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>     <span class="ansi-green-fg">def</span> show_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">,</span> ctxs<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> show<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>         <span class="ansi-green-fg">if</span> b <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> b <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 90</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> show<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_pre_show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     91</span>         show_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>_pre_show_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> ctxs<span class="ansi-blue-fg">=</span>ctxs<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span>max_n<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     92</span> 

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">_pre_show_batch</span><span class="ansi-blue-fg">(self, b, max_n)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>     <span class="ansi-green-fg">def</span> _pre_show_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     81</span>         <span class="ansi-blue-fg">&#34;Decode `b` to be ready for `show_batch`&#34;</span>
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg">         </span>b <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;show&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> b<span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         its <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_decode_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/data/core.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span>Pipeline<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> f<span class="ansi-blue-fg">.</span>split_idx<span class="ansi-blue-fg">=</span>split_idx
<span class="ansi-green-intense-fg ansi-bold">     71</span> 
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> decode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>before_batch<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>to_cpu<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>after_batch<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_retain_dl<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>     <span class="ansi-green-fg">def</span> decode_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9</span><span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_decode_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> max_n<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, o, full)</span>
<span class="ansi-green-intense-fg ansi-bold">    194</span> 
<span class="ansi-green-intense-fg ansi-bold">    195</span>     <span class="ansi-green-fg">def</span> decode  <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">,</span> full<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 196</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> full<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> compose_tfms<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">,</span> tfms<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">,</span> is_enc<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> reverse<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>split_idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span>         <span class="ansi-red-fg">#Not full means we decode up to the point the item knows how to show itself.</span>
<span class="ansi-green-intense-fg ansi-bold">    198</span>         <span class="ansi-green-fg">for</span> f <span class="ansi-green-fg">in</span> reversed<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">compose_tfms</span><span class="ansi-blue-fg">(x, tfms, is_enc, reverse, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>     <span class="ansi-green-fg">for</span> f <span class="ansi-green-fg">in</span> tfms<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    135</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> is_enc<span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">.</span>decode
<span class="ansi-green-fg">--&gt; 136</span><span class="ansi-red-fg">         </span>x <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    137</span>     <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">    138</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>     <span class="ansi-green-fg">def</span> name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_name&#39;</span><span class="ansi-blue-fg">,</span> _get_name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;encodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> decode  <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;decodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>     <span class="ansi-green-fg">def</span> __repr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#39;{self.name}: {self.use_as_item} {self.encodes} {self.decodes}&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_call</span><span class="ansi-blue-fg">(self, fn, x, split_idx, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>         <span class="ansi-green-fg">if</span> split_idx<span class="ansi-blue-fg">!=</span>self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">and</span> self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">     81</span>         f <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>use_as_item <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> is_listy<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span>         res <span class="ansi-blue-fg">=</span> tuple<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> x_<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> x_ <span class="ansi-green-fg">in</span> x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span>         <span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_do_call</span><span class="ansi-blue-fg">(self, f, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     85</span> 
<span class="ansi-green-intense-fg ansi-bold">     86</span>     <span class="ansi-green-fg">def</span> _do_call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 87</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> x <span class="ansi-green-fg">if</span> f <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> retain_type<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">.</span>returns_none<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span> 
<span class="ansi-green-intense-fg ansi-bold">     89</span> add_docs<span class="ansi-blue-fg">(</span>Transform<span class="ansi-blue-fg">,</span> decode<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Delegate to `decodes` to undo transform&#34;</span><span class="ansi-blue-fg">,</span> setup<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Delegate to `setups` to set up transform&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastcore/fastcore/dispatch.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> f<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>inst <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> MethodType<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>inst<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 98</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span> 
<span class="ansi-green-intense-fg ansi-bold">    100</span>     <span class="ansi-green-fg">def</span> __get__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> inst<span class="ansi-blue-fg">,</span> owner<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/fastseq/fastseq/data/transforms.py</span> in <span class="ansi-cyan-fg">decodes</span><span class="ansi-blue-fg">(self, o)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> 
<span class="ansi-green-intense-fg ansi-bold">     19</span>     <span class="ansi-green-fg">def</span> decodes<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> Tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>s<span class="ansi-blue-fg">+</span>self<span class="ansi-blue-fg">.</span>m <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastseq/fastseq/data/transforms.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> 
<span class="ansi-green-intense-fg ansi-bold">     19</span>     <span class="ansi-green-fg">def</span> decodes<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> Tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">*</span>self<span class="ansi-blue-fg">.</span>s<span class="ansi-blue-fg">+</span>self<span class="ansi-blue-fg">.</span>m <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/fastai2/fastai2/torch_core.py</span> in <span class="ansi-cyan-fg">_f</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>         <span class="ansi-green-fg">def</span> _f<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>             cls <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>__class__
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">             </span>res <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>super<span class="ansi-blue-fg">(</span>TensorBase<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>             <span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span>         <span class="ansi-green-fg">return</span> _f

<span class="ansi-red-fg">RuntimeError</span>: expected device cpu but got device cuda:0</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

